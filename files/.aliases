#!/bin/bash

# Essentials
alias ll='exa -hal'
alias la='exa -a'
alias v='nvim'
alias claer='clear'

# Git
alias gs='git status'
alias gd='git diff'
alias gl='glols' # git plugin for zsh

gpush() {
    cur_branch=$(git branch --show-current)
    has_remote=$(git branch -r --list "origin/$cur_branch")
    if [[ $has_remote ]]; then
        git push "$@"
    else
        echo "No remote branch found, creating one"
        git push --set-upstream origin "$cur_branch" "$@"
    fi
}

is-git-repo() {
    git rev-parse HEAD > /dev/null 2>&1
}

fzf-git-branch() {
    is-git-repo || return

    git branch --all --color=always --sort=-committerdate | grep -v HEAD | sed 's/^..//' | cut -d' ' -f1 |
    fzf-tmux \
        -p 80%,60%\
        --ansi \
        --header "Enter (checkout) / Ctrl-a (checkout -b) / Ctrl-t (checkout --track) / Ctrl-d (delete)" \
        --bind "enter:execute:git checkout {..}" \
        --bind "enter:+accept" \
        --bind "ctrl-a:execute:git checkout -b {q}" \
        --bind "ctrl-a:+accept" \
        --bind "ctrl-t:execute:git checkout --track {..}" \
        --bind "ctrl-t:+accept" \
        --bind "ctrl-d:execute:git branch -d {..}" \
        --bind "ctrl-d:+accept" \
        --preview-window right:50% \
        --preview 'git log -n 50 --color=always --date=short --pretty="format:%C(auto)%cd %h%d %s" $(sed "s/.* //" <<< {})'
}

alias gc='fzf-git-branch'
alias lg='lazygit'

# Others
source-envfile() {
    set -a
    source "$1"
    set +a
}

alias sqlize='python ~/sqlize.py | pbcopy'
